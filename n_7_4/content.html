import React, { useState } from 'react';
import { 
  BookOpen, 
  CheckCircle2, 
  AlertCircle, 
  Lightbulb, 
  Trophy,
  RefreshCcw,
  MessageSquare,
  ChevronRight,
  ArrowRight,
  Send,
  HelpCircle,
  Plus,
  Minus,
  Pencil,
  ClipboardCheck,
  RotateCcw,
  FileText,
  Check
} from 'lucide-react';

// --- éœæ…‹è³‡æ–™å®šç¾© ---

const lawQuiz = [
  { q: "7 + 9 = 9 + 7", a: "äº¤æ›å¾‹", detail: "é€™æ˜¯æŠŠæ•¸å­—çš„é †åºå°æ›ï¼Œçµæœä¸è®Šã€‚" },
  { q: "(3 + 5) + 2 = 3 + (5 + 2)", a: "çµåˆå¾‹", detail: "æ‹¬è™Ÿå…ˆåœä½èª°éƒ½ä¸€æ¨£ï¼Œå¸¸ç”¨ä¾†æ¹Šæ•´æ•¸ã€‚" },
  { q: "6 Ã— (4 + 1) = 6 Ã— 4 + 6 Ã— 1", a: "åˆ†é…å¾‹", detail: "å°‡æ‹¬è™Ÿå¤–çš„ 6 åˆ†åˆ¥ä¹˜é€²å»ã€‚" }
];

const testQuestions = [
  {
    id: 1,
    title: "åŸºç¤è¨ˆç®— (åˆ†é…å¾‹)",
    q: "è¨ˆç®— 123 Ã— 45 + 123 Ã— 55 = ?",
    answer: "12300",
    hint: "è§€å¯Ÿå…©é …éƒ½æœ‰å…¬å› æ•¸ 123ï¼Œå…ˆåˆä½µå¾Œé¢çš„ (45 + 55)ã€‚"
  },
  {
    id: 2,
    title: "å»æ‹¬è™Ÿè¦å‰‡",
    q: "åŒ–ç°¡ç®—å¼ -(15 - 8 + 22) çš„æœ€å¾Œæ•¸å€¼ç‚ºï¼Ÿ",
    answer: "-29",
    hint: "å…ˆå»æ‹¬è™Ÿè®Šè™Ÿç‚º -15 + 8 - 22ï¼Œå†ç”±å·¦å‘å³è¨ˆç®—ã€‚"
  },
  {
    id: 3,
    title: "é€²éšé€Ÿç®— (æ‹†è§£æ³•)",
    q: "è¨ˆç®— 99 Ã— 13 = ?",
    answer: "1287",
    hint: "å°‡ 99 æ‹†æˆ (100 - 1)ï¼Œåˆ©ç”¨åˆ†é…å¾‹ 100 Ã— 13 - 1 Ã— 13ã€‚"
  },
  {
    id: 4,
    title: "æ··åˆé‹ç®—èˆ‡æ­£è² è™Ÿ",
    q: "è¨ˆç®— -(-18) + (-25) - 13 = ?",
    answer: "-20",
    hint: "-(-18) è®Šè™Ÿç‚º 18ï¼Œç®—å¼è®Šç‚º 18 - 25 - 13ã€‚"
  },
  {
    id: 5,
    title: "è§€å¿µåˆ¤æ–·",
    q: "è‹¥ a = 15, b = 20ï¼Œå‰‡ (a - b) æ˜¯å¦ç­‰æ–¼ (b - a)ï¼Ÿ(è«‹å¡«ã€Œæ˜¯ã€æˆ–ã€Œå¦ã€)",
    answer: "å¦",
    hint: "æ¸›æ³•ä¸ç¬¦åˆäº¤æ›å¾‹ï¼Œ15-20 = -5 è€Œ 20-15 = 5ã€‚"
  }
];

const MathFact = ({ children }) => (
  <span className="bg-amber-100 text-amber-900 px-2 py-0.5 rounded font-mono font-bold mx-1 border border-amber-200">
    {children}
  </span>
);

const App = () => {
  const [quizFeedbacks, setQuizFeedbacks] = useState({});
  const [testUserAnswers, setTestUserAnswers] = useState({});
  const [checkedQuestions, setCheckedQuestions] = useState({}); // ç´€éŒ„å“ªäº›é¡Œç›®å·²ç¶“å°éç­”æ¡ˆ

  const handleQuizAnswer = (idx, selected, correct, detail) => {
    setQuizFeedbacks(prev => ({
      ...prev,
      [idx]: {
        show: true,
        message: selected === correct ? `âœ… æ­£ç¢ºï¼${detail}` : `âŒ å¯æƒœï¼${detail}`,
        isCorrect: selected === correct
      }
    }));
  };

  const handleCheckAnswer = (id) => {
    setCheckedQuestions(prev => ({ ...prev, [id]: true }));
  };

  const resetTest = () => {
    setTestUserAnswers({});
    setCheckedQuestions({});
  };

  const correctCount = testQuestions.filter(q => checkedQuestions[q.id] && testUserAnswers[q.id]?.trim() === q.answer).length;

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900 font-sans p-4 md:p-8">
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .section-card { @apply bg-white rounded-2xl shadow-sm p-6 mb-8 border border-slate-200 transition-all hover:shadow-md; }
        .test-input { @apply w-full md:w-48 px-4 py-2 border-2 rounded-lg font-mono text-lg focus:outline-none focus:ring-2 transition-all; }
      `}</style>

      {/* Header */}
      <header className="max-w-4xl mx-auto text-center mb-10">
        <h1 className="text-4xl md:text-5xl font-black text-slate-800 mb-3 tracking-tight">
          ğŸ“˜ æ•¸çš„é‹ç®—è¦å¾‹
        </h1>
        <div className="inline-block px-4 py-1 bg-indigo-100 text-indigo-700 rounded-full font-bold text-sm">
          N-7-4 äº’å‹•å¼å­¸ç¿’è¬›ç¾©
        </div>
      </header>

      <div className="max-w-4xl mx-auto">
        
        {/* 1. å­¸ç¿’ç›®æ¨™ */}
        <section className="bg-white rounded-2xl shadow-sm p-6 mb-8 border-l-8 border-blue-500">
          <h2 className="text-xl font-bold text-blue-700 mb-4 flex items-center gap-2">
            <CheckCircle2 className="w-6 h-6" /> ğŸ¯ å­¸ç¿’ç›®æ¨™
          </h2>
          <ul className="grid md:grid-cols-2 gap-3 text-slate-700 font-medium">
            <li className="flex items-center gap-2">â— æŒæ¡åŠ æ³•èˆ‡ä¹˜æ³•çš„äº¤æ›å¾‹ã€çµåˆå¾‹</li>
            <li className="flex items-center gap-2">â— éˆæ´»é‹ç”¨ä¹˜æ³•å°åŠ æ³•çš„åˆ†é…å¾‹</li>
            <li className="flex items-center gap-2">â— ç ´è§£è² è™Ÿå»æ‹¬è™Ÿçš„è®Šè™Ÿé™·é˜±</li>
            <li className="flex items-center gap-2">â— é¤Šæˆã€Œå…ˆè§€å¯Ÿã€å†è¨ˆç®—ã€çš„æ•¸æ„Ÿ</li>
          </ul>
        </section>

        {/* 2. æ ¸å¿ƒæ¦‚å¿µå¡ç‰‡ */}
        <div className="grid md:grid-cols-3 gap-4 mb-8">
          <div className="bg-green-50 p-5 rounded-xl border border-green-200 shadow-sm">
            <h3 className="font-bold text-green-700 text-lg mb-2">1ï¸âƒ£ äº¤æ›å¾‹</h3>
            <div className="space-y-2 text-xs font-mono">
              <MathFact>a + b = b + a</MathFact>
              <MathFact>a Ã— b = b Ã— a</MathFact>
            </div>
          </div>
          <div className="bg-slate-100 p-5 rounded-xl border border-slate-200 shadow-sm">
            <h3 className="font-bold text-slate-700 text-lg mb-2">2ï¸âƒ£ çµåˆå¾‹</h3>
            <div className="space-y-2 text-xs font-mono">
              <MathFact>(a+b)+c = a+(b+c)</MathFact>
              <MathFact>(aÃ—b)Ã—c = aÃ—(bÃ—c)</MathFact>
            </div>
          </div>
          <div className="bg-orange-50 p-5 rounded-xl border border-orange-200 shadow-sm">
            <h3 className="font-bold text-orange-700 text-lg mb-2">3ï¸âƒ£ åˆ†é…å¾‹</h3>
            <div className="text-xs font-mono">
              <MathFact>a(b + c) = ab + ac</MathFact>
            </div>
          </div>
        </div>

        {/* 3. å»æ‹¬è™Ÿè¦å‰‡å€å¡Š */}
        <section className="bg-red-50 p-6 rounded-2xl border border-red-200 shadow-sm border-l-8 border-l-red-500 mb-8">
          <h2 className="text-xl font-bold text-red-700 mb-2 flex items-center gap-2">
            <AlertCircle className="w-6 h-6" /> 4ï¸âƒ£ å»æ‹¬è™Ÿé™·é˜±
          </h2>
          <p className="text-sm text-red-800 font-bold mb-4">ğŸ’¡ è¨£ç«…ï¼šè² è™Ÿé€²å…¥æ‹¬è™Ÿï¼Œå…§éƒ¨ã€Œæ¯ä¸€é …ã€éƒ½è¦è®Šè™Ÿã€‚</p>
          <div className="grid md:grid-cols-2 gap-4 font-mono font-bold">
            <div className="bg-white p-3 rounded-xl border border-red-100 text-center">
              -(a + b) = - a - b
            </div>
            <div className="bg-white p-3 rounded-xl border border-red-100 text-center">
              -(a - b) = - a + b
            </div>
          </div>
        </section>

        {/* 4. è¦å¾‹å¿«é€Ÿåˆ¤æ–· */}
        <section className="section-card">
          <h2 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
            ğŸ§© ç†±èº«ç·´ç¿’ï¼šè¦å¾‹è¾¨è­˜
          </h2>
          <div className="space-y-4">
            {lawQuiz.map((item, idx) => (
              <div key={idx} className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                <p className="text-lg font-mono font-bold text-slate-700 mb-3">{item.q}</p>
                <div className="flex flex-wrap gap-2">
                  {["äº¤æ›å¾‹", "çµåˆå¾‹", "åˆ†é…å¾‹"].map(btn => (
                    <button
                      key={btn}
                      onClick={() => handleQuizAnswer(idx, btn, item.a, item.detail)}
                      className="px-4 py-1.5 bg-white border border-slate-300 hover:border-indigo-500 rounded-lg text-sm font-bold transition-all"
                    >
                      {btn}
                    </button>
                  ))}
                </div>
                {quizFeedbacks[idx]?.show && (
                  <p className={`mt-2 text-sm font-bold ${quizFeedbacks[idx].isCorrect ? 'text-green-600' : 'text-red-600'}`}>
                    {quizFeedbacks[idx].message}
                  </p>
                )}
              </div>
            ))}
          </div>
        </section>

        {/* 5. å…¨èƒ½æŒ‘æˆ°æ¸¬é©— (å³æ™‚å°ç­”æ¡ˆç‰ˆ) */}
        <section className="bg-white rounded-3xl shadow-xl border-2 border-indigo-100 overflow-hidden mb-12 animate-in fade-in duration-700">
          <div className="bg-indigo-600 p-6 text-white flex justify-between items-center">
            <div>
              <h2 className="text-2xl font-bold flex items-center gap-2">
                ğŸš€ å…¨èƒ½æŒ‘æˆ°ï¼šå³æ™‚å°ç­”æ¡ˆ
              </h2>
              <p className="text-indigo-100 text-sm mt-1">å¯«å®Œä¸€é¡Œï¼Œç«‹åˆ»æŒ‰ã€Œå°ç­”æ¡ˆã€æª¢æŸ¥çµæœï¼</p>
            </div>
            <FileText className="w-10 h-10 opacity-30" />
          </div>

          <div className="p-6 md:p-10 space-y-12">
            {testQuestions.map((q, idx) => {
              const isChecked = checkedQuestions[q.id];
              const isCorrect = testUserAnswers[q.id]?.trim() === q.answer;

              return (
                <div key={q.id} className="relative pl-8 transition-all duration-300">
                  <span className="absolute left-0 top-0 text-3xl font-black text-indigo-100 leading-none">{idx + 1}</span>
                  <div className="mb-4">
                    <h3 className="font-bold text-indigo-900 text-lg mb-1">{q.title}</h3>
                    <p className="text-slate-800 text-xl font-mono bg-slate-50 p-4 rounded-xl border border-slate-100 shadow-inner">
                      {q.q}
                    </p>
                  </div>
                  
                  <div className="flex flex-wrap items-center gap-4">
                    <div className="flex items-center gap-2">
                      <span className="font-bold text-slate-500">ç­”ï¼š</span>
                      <input 
                        type="text" 
                        value={testUserAnswers[q.id] || ""}
                        onChange={(e) => setTestUserAnswers({...testUserAnswers, [q.id]: e.target.value})}
                        disabled={isChecked}
                        className={`test-input ${
                          isChecked 
                            ? (isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') 
                            : 'border-slate-200 focus:border-indigo-500'
                        }`}
                        placeholder="å¡«å…¥æ•¸å­—"
                      />
                    </div>
                    
                    {!isChecked ? (
                      <button 
                        onClick={() => handleCheckAnswer(q.id)}
                        disabled={!testUserAnswers[q.id]}
                        className="px-6 py-2 bg-indigo-500 text-white rounded-lg font-bold hover:bg-indigo-600 disabled:opacity-30 flex items-center gap-1 shadow-sm transition-all"
                      >
                        <Send className="w-4 h-4" /> å°ç­”æ¡ˆ
                      </button>
                    ) : (
                      <div className="animate-in slide-in-from-left duration-300 flex items-center gap-3">
                        {isCorrect ? (
                          <span className="flex items-center gap-1 text-green-600 font-bold text-lg bg-green-100 px-3 py-1 rounded-full">
                            <CheckCircle2 className="w-5 h-5" /> æ­£ç¢º
                          </span>
                        ) : (
                          <div className="text-red-600 font-bold bg-red-100 px-3 py-1 rounded-full flex items-center gap-1">
                            <AlertCircle className="w-5 h-5" /> éŒ¯èª¤
                          </div>
                        )}
                        <button 
                          onClick={() => setCheckedQuestions(prev => {
                            const newStatus = {...prev};
                            delete newStatus[q.id];
                            return newStatus;
                          })}
                          className="text-slate-400 hover:text-indigo-600 text-sm underline flex items-center gap-1"
                        >
                          <RotateCcw className="w-3 h-3" /> é‡å¯«
                        </button>
                      </div>
                    )}
                  </div>

                  {isChecked && (
                    <div className="mt-4 p-4 bg-indigo-50 rounded-xl border border-indigo-100 text-sm text-indigo-900 animate-in fade-in">
                      {!isCorrect && <p className="mb-2 font-black text-red-600 italic">æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š{q.answer}</p>}
                      <span className="font-bold flex items-center gap-1 mb-1">
                        <Lightbulb className="w-4 h-4" /> è§£é¡Œå»ºè­°ï¼š
                      </span>
                      {q.hint}
                    </div>
                  )}
                </div>
              );
            })}

            {/* é€²åº¦ç¸½çµ */}
            <div className="pt-8 text-center border-t border-slate-100">
              <div className="flex flex-col items-center">
                <div className="flex gap-2 mb-4">
                  {testQuestions.map(q => (
                    <div 
                      key={q.id}
                      className={`w-4 h-4 rounded-full ${
                        checkedQuestions[q.id] 
                          ? (testUserAnswers[q.id]?.trim() === q.answer ? 'bg-green-500' : 'bg-red-500') 
                          : 'bg-slate-200'
                      }`}
                    />
                  ))}
                </div>
                <p className="text-slate-500 font-bold">
                  ç›®å‰é€²åº¦ï¼šå·²å®Œæˆ {Object.keys(checkedQuestions).length} / {testQuestions.length} é¡Œ
                  {Object.keys(checkedQuestions).length > 0 && ` (ç­”å° ${correctCount} é¡Œ)`}
                </p>
                {Object.keys(checkedQuestions).length === testQuestions.length && (
                  <div className="mt-6 animate-in zoom-in">
                    <Trophy className="w-12 h-12 text-yellow-400 mx-auto mb-2" />
                    <p className="text-2xl font-black text-indigo-900">
                      ç¸½çµï¼š{correctCount * 20} åˆ†ï¼
                    </p>
                    <button 
                      onClick={resetTest}
                      className="mt-4 px-6 py-2 bg-slate-200 text-slate-700 rounded-full font-bold hover:bg-slate-300 transition-all flex items-center gap-2 mx-auto"
                    >
                      <RotateCcw className="w-4 h-4" /> å…¨éƒ¨é‡ä¾†
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        </section>

        {/* 6. å¸¸è¦‹è¿·æ€èˆ‡åæ€ */}
        <footer className="grid md:grid-cols-2 gap-6 mb-12">
          <div className="section-card border-t-4 border-red-400">
            <h3 className="font-bold text-red-600 mb-4 flex items-center gap-2">
              <AlertCircle className="w-5 h-5" /> å¸¸è¦‹è¿·æ€
            </h3>
            <ul className="text-sm space-y-4 font-medium text-slate-600">
              <li className="flex items-start gap-2">
                <span className="text-red-500">âŒ</span>
                <div>
                  <span className="font-bold">æ¸›æ³•äº¤æ›å¾‹</span>
                  <p className="text-slate-400 font-normal">3 - 5 ä¸ç­‰æ–¼ 5 - 3ï¼Œé †åºä¸å¯éš¨ä¾¿æ›ã€‚</p>
                </div>
              </li>
              <li className="flex items-start gap-2">
                <span className="text-red-500">âŒ</span>
                <div>
                  <span className="font-bold">æ¼æ‰åˆ†é…å¾‹çš„å¾Œé …</span>
                  <p className="text-slate-400 font-normal">2 Ã— (3 + 5) å¿…é ˆå…©é …éƒ½ä¹˜åˆ°ï¼Œä¸èƒ½åªä¹˜ 3ã€‚</p>
                </div>
              </li>
            </ul>
          </div>
          <div className="bg-slate-800 text-slate-100 p-6 rounded-2xl shadow-sm">
            <h3 className="font-bold mb-4 border-b border-slate-700 pb-2 flex items-center gap-2">
              <MessageSquare className="w-5 h-5 text-indigo-400" /> æ€è€ƒé¡Œ
            </h3>
            <p className="text-sm leading-relaxed italic text-slate-400">
              ã€Œå¦‚æœä¸€å€‹ç®—å¼è£¡æœ‰åŠ ã€æ¸›ã€ä¹˜ã€é™¤ï¼Œä»€éº¼æ™‚å€™æœ€é©åˆä½¿ç”¨åˆ†é…å¾‹ä¾†ç°¡åŒ–é‹ç®—å‘¢ï¼Ÿã€
            </p>
          </div>
        </footer>

      </div>

      <div className="max-w-4xl mx-auto text-center text-slate-400 text-xs pb-10">
        åäºŒå¹´åœ‹æ•™æ•¸å­¸é ˜åŸŸ N-7-4 è¦ç¯„è£½ä½œ â€¢ äº’å‹•å¼æ•¸ä½ç·´ç¿’ç³»çµ±
      </div>
    </div>
  );
};

export default App;
