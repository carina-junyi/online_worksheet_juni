<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-7-4 æ•¸çš„é‹ç®—è¦å¾‹äº’å‹•è¬›ç¾©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }
        .math-fact {
            background-color: #fef3c7;
            color: #92400e;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            font-family: monospace;
            border: 1px solid #fde68a;
            margin: 0 2px;
        }
        .section-card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .section-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .animate-shake {
            animation: shake 0.3s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .step-inactive {
            opacity: 0.2;
            filter: grayscale(1);
            pointer-events: none;
        }
        .step-active {
            border-color: #fbbf24;
            background-color: #fffbeb;
            box-shadow: 0 0 0 2px #fef3c7;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-black text-slate-800 mb-3 tracking-tight">ğŸ“˜ æ•¸çš„é‹ç®—è¦å¾‹</h1>
            <div class="inline-block px-4 py-1 bg-indigo-100 text-indigo-700 rounded-full font-bold text-sm">N-7-4 äº’å‹•å¼å­¸ç¿’è¬›ç¾©</div>
        </header>

        <!-- 1. å­¸ç¿’ç›®æ¨™ -->
        <section class="bg-white rounded-2xl shadow-sm p-6 mb-8 border-l-8 border-blue-500">
            <h2 class="text-xl font-bold text-blue-700 mb-4 flex items-center gap-2">
                <i data-lucide="check-circle-2"></i> ğŸ¯ å­¸ç¿’ç›®æ¨™
            </h2>
            <ul class="grid md:grid-cols-2 gap-3 text-slate-700 font-medium">
                <li class="flex items-center gap-2">â— æŒæ¡åŠ æ³•èˆ‡ä¹˜æ³•çš„äº¤æ›å¾‹ã€çµåˆå¾‹</li>
                <li className="flex items-center gap-2">â— éˆæ´»é‹ç”¨ä¹˜æ³•å°åŠ æ³•çš„åˆ†é…å¾‹</li>
                <li className="flex items-center gap-2">â— ç ´è§£è² è™Ÿå»æ‹¬è™Ÿçš„è®Šè™Ÿé™·é˜±</li>
                <li className="flex items-center gap-2">â— é¤Šæˆã€Œå…ˆè§€å¯Ÿã€å†è¨ˆç®—ã€çš„æ•¸æ„Ÿ</li>
            </ul>
        </section>

        <!-- 2. æ ¸å¿ƒæ¦‚å¿µå¡ç‰‡ -->
        <div class="grid md:grid-cols-3 gap-4 mb-8">
            <div class="bg-green-50 p-5 rounded-xl border border-green-200">
                <h3 class="font-bold text-green-700 text-lg mb-2">1ï¸âƒ£ äº¤æ›å¾‹</h3>
                <div class="space-y-2 text-xs font-mono">
                    <span class="math-fact text-xs">a + b = b + a</span>
                    <span class="math-fact text-xs">a Ã— b = b Ã— a</span>
                </div>
            </div>
            <div class="bg-slate-100 p-5 rounded-xl border border-slate-200">
                <h3 class="font-bold text-slate-700 text-lg mb-2">2ï¸âƒ£ çµåˆå¾‹</h3>
                <div class="space-y-2 text-xs font-mono">
                    <span class="math-fact text-xs">(a+b)+c = a+(b+c)</span>
                    <span class="math-fact text-xs">(aÃ—b)Ã—c = aÃ—(bÃ—c)</span>
                </div>
            </div>
            <div class="bg-orange-50 p-5 rounded-xl border border-orange-200">
                <h3 class="font-bold text-orange-700 text-lg mb-2">3ï¸âƒ£ åˆ†é…å¾‹</h3>
                <div class="text-xs font-mono">
                    <span class="math-fact text-xs">a(b + c) = ab + ac</span>
                </div>
            </div>
        </div>

        <!-- 3. å»æ‹¬è™Ÿè¦å‰‡ -->
        <section class="bg-red-50 p-6 rounded-2xl border border-red-200 border-l-8 border-l-red-500 mb-8">
            <h2 class="text-xl font-bold text-red-700 mb-2 flex items-center gap-2">
                <i data-lucide="alert-circle"></i> 4ï¸âƒ£ å»æ‹¬è™Ÿé™·é˜±
            </h2>
            <p class="text-sm text-red-800 font-bold mb-4">ğŸ’¡ è¨£ç«…ï¼šè² è™Ÿé€²å…¥æ‹¬è™Ÿï¼Œå…§éƒ¨ã€Œæ¯ä¸€é …ã€éƒ½è¦è®Šè™Ÿã€‚</p>
            <div class="grid md:grid-cols-2 gap-4 font-mono font-bold">
                <div class="bg-white p-3 rounded-xl border border-red-100 text-center">-(a + b) = - a - b</div>
                <div class="bg-white p-3 rounded-xl border border-red-100 text-center">-(a - b) = - a + b</div>
            </div>
        </section>

        <!-- 4. è¦å¾‹è¾¨è­˜ -->
        <section class="section-card">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                <i data-lucide="puzzle"></i> ç†±èº«ç·´ç¿’ï¼šè¦å¾‹è¾¨è­˜
            </h2>
            <div id="law-quiz-container" class="space-y-4">
                <!-- Law Quiz injected here -->
            </div>
        </section>

        <!-- 5. å»æ‹¬è™Ÿå¯¦é©—å®¤ -->
        <section class="bg-amber-50 rounded-2xl shadow-sm p-6 md:p-8 mb-8 border border-amber-200">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-amber-800 flex items-center gap-2">
                        <i data-lucide="search"></i> å¯¦æˆ°ï¼šå»æ‹¬è™Ÿå¯¦é©—å®¤
                    </h2>
                    <p class="text-amber-700/70 text-sm font-medium mt-1">æ€è€ƒçœ‹çœ‹ï¼šå»æ‹¬è™Ÿå¾Œï¼Œé …ç›®çš„ç¬¦è™Ÿè©²å¦‚ä½•é¸æ“‡ï¼Ÿ</p>
                </div>
                <button onclick="nextLabProblem()" class="flex items-center gap-2 px-4 py-2 bg-amber-600 text-white rounded-xl font-bold hover:bg-amber-700 transition-colors shadow-md">
                    æ›´æ›é¡Œç›® <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </button>
            </div>
            <div class="bg-white rounded-2xl p-6 mb-8 border-2 border-amber-100 shadow-inner">
                <div id="lab-header" class="text-center mb-8">
                    <!-- Title & Expression here -->
                </div>
                <div id="lab-steps" class="space-y-4">
                    <!-- Steps here -->
                </div>
                <div id="lab-success" class="mt-8 text-center hidden">
                    <!-- Success message -->
                </div>
            </div>
        </section>

        <!-- 6. é€Ÿç®—æŒ‘æˆ° -->
        <section class="bg-indigo-900 text-white p-8 rounded-3xl shadow-xl mb-8 relative overflow-hidden">
            <div class="relative z-10">
                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2 italic tracking-wide">
                    ğŸš€ é€Ÿç®—æŒ‘æˆ°ï¼š<span class="font-mono text-yellow-300">99 Ã— 6 + 6</span>
                </h2>
                <div id="speed-challenge-container" class="bg-white/10 p-6 rounded-2xl border border-white/20 mb-6 min-h-[160px] flex flex-col justify-center">
                    <!-- Speed challenge state here -->
                </div>
            </div>
            <i data-lucide="trophy" class="absolute right-[-20px] bottom-[-20px] w-48 h-48 text-white/5 rotate-12"></i>
        </section>

        <!-- 7. å…¨èƒ½æŒ‘æˆ°æ¸¬é©— -->
        <section class="bg-white rounded-3xl shadow-xl border-2 border-indigo-100 overflow-hidden mb-12">
            <div class="bg-indigo-600 p-6 text-white flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold flex items-center gap-2">
                        <i data-lucide="file-text"></i> å…¨èƒ½æŒ‘æˆ°ï¼šå³æ™‚å°ç­”æ¡ˆ
                    </h2>
                    <p class="text-indigo-100 text-sm mt-1">å¯«å®Œä¸€é¡Œï¼Œç«‹åˆ»æŒ‰ã€Œå°ç­”æ¡ˆã€æª¢æŸ¥çµæœï¼</p>
                </div>
                <i data-lucide="clipboard-check" class="w-10 h-10 opacity-30"></i>
            </div>
            <div id="test-container" class="p-6 md:p-10 space-y-12">
                <!-- Test questions injected here -->
            </div>
            <!-- Test Footer -->
            <div class="p-8 border-t border-slate-100 text-center bg-slate-50">
                <div id="test-summary" class="flex flex-col items-center">
                    <!-- Summary content -->
                </div>
            </div>
        </section>

        <!-- 8. Footer Footer -->
        <footer class="grid md:grid-cols-2 gap-6 mb-12">
            <div class="section-card border-t-4 border-red-400">
                <h3 class="font-bold text-red-600 mb-4 flex items-center gap-2">
                    <i data-lucide="alert-circle"></i> å¸¸è¦‹è¿·æ€
                </h3>
                <ul class="text-sm space-y-4 font-medium text-slate-600">
                    <li class="flex items-start gap-2">
                        <span class="text-red-500">âŒ</span>
                        <div>
                            <span class="font-bold">æ¸›æ³•äº¤æ›å¾‹</span>
                            <p class="text-slate-400 font-normal">3 - 5 ä¸ç­‰æ–¼ 5 - 3ï¼Œé †åºä¸å¯éš¨ä¾¿æ›ã€‚</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2">
                        <span class="text-red-500">âŒ</span>
                        <div>
                            <span class="font-bold">æ¼æ‰åˆ†é…å¾‹çš„å¾Œé …</span>
                            <p class="text-slate-400 font-normal">2 Ã— (3 + 5) å¿…é ˆå…©é …éƒ½ä¹˜åˆ°ï¼Œä¸èƒ½åªä¹˜ 3ã€‚</p>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="bg-slate-800 text-slate-100 p-6 rounded-2xl shadow-sm">
                <h3 class="font-bold mb-4 border-b border-slate-700 pb-2 flex items-center gap-2">
                    <i data-lucide="message-square" class="text-indigo-400"></i> æ€è€ƒé¡Œ
                </h3>
                <p class="text-sm leading-relaxed italic text-slate-400">
                    ã€Œå¦‚æœä¸€å€‹ç®—å¼è£¡æœ‰åŠ ã€æ¸›ã€ä¹˜ã€é™¤ï¼Œä»€éº¼æ™‚å€™æœ€é©åˆä½¿ç”¨åˆ†é…å¾‹ä¾†ç°¡åŒ–é‹ç®—å‘¢ï¼Ÿã€
                </p>
            </div>
        </footer>
        <div class="text-center text-slate-400 text-xs pb-10">
            åäºŒå¹´åœ‹æ•™æ•¸å­¸é ˜åŸŸ N-7-4 è¦ç¯„è£½ä½œ â€¢ äº’å‹•å¼æ•¸ä½ç·´ç¿’ç³»çµ±
        </div>
    </div>

    <script>
        // --- Data ---
        const lawQuizData = [
            { q: "7 + 9 = 9 + 7", a: "äº¤æ›å¾‹", detail: "é€™æ˜¯æŠŠæ•¸å­—çš„é †åºå°æ›ï¼Œçµæœä¸è®Šã€‚" },
            { q: "(3 + 5) + 2 = 3 + (5 + 2)", a: "çµåˆå¾‹", detail: "æ‹¬è™Ÿå…ˆåœä½èª°éƒ½ä¸€æ¨£ï¼Œå¸¸ç”¨ä¾†æ¹Šæ•´æ•¸ã€‚" },
            { q: "6 Ã— (4 + 1) = 6 Ã— 4 + 6 Ã— 1", a: "åˆ†é…å¾‹", detail: "å°‡æ‹¬è™Ÿå¤–çš„ 6 åˆ†åˆ¥ä¹˜é€²å»ã€‚" }
        ];

        const testQuestions = [
            { id: 1, title: "åŸºç¤è¨ˆç®— (åˆ†é…å¾‹)", q: "è¨ˆç®— 123 Ã— 45 + 123 Ã— 55 = ?", answer: "12300", hint: "è§€å¯Ÿå…©é …éƒ½æœ‰å…¬å› æ•¸ 123ï¼Œå…ˆåˆä½µå¾Œé¢çš„ (45 + 55)ã€‚" },
            { id: 2, title: "å»æ‹¬è™Ÿè¦å‰‡", q: "åŒ–ç°¡ç®—å¼ -(15 - 8 + 22) çš„æœ€å¾Œæ•¸å€¼ç‚ºï¼Ÿ", answer: "-29", hint: "å…ˆå»æ‹¬è™Ÿè®Šè™Ÿç‚º -15 + 8 - 22ï¼Œå†ç”±å·¦å‘å³è¨ˆç®—ã€‚" },
            { id: 3, title: "é€²éšé€Ÿç®— (æ‹†è§£æ³•)", q: "è¨ˆç®— 99 Ã— 13 = ?", answer: "1287", hint: "å°‡ 99 æ‹†æˆ (100 - 1)ï¼Œåˆ©ç”¨åˆ†é…å¾‹ 100 Ã— 13 - 1 Ã— 13ã€‚" },
            { id: 4, title: "æ··åˆé‹ç®—èˆ‡æ­£è² è™Ÿ", q: "è¨ˆç®— -(-18) + (-25) - 13 = ?", answer: "-20", hint: "-(-18) è®Šè™Ÿç‚º 18ï¼Œç®—å¼è®Šç‚º 18 - 25 - 13ã€‚" },
            { id: 5, title: "è§€å¿µåˆ¤æ–·", q: "è‹¥ a = 15, b = 20ï¼Œå‰‡ (a - b) æ˜¯å¦ç­‰æ–¼ (b - a)ï¼Ÿ(è«‹å¡«ã€Œæ˜¯ã€æˆ–ã€Œå¦ã€)", answer: "å¦", hint: "æ¸›æ³•ä¸ç¬¦åˆäº¤æ›å¾‹ï¼Œ15-20 = -5 è€Œ 20-15 = 5ã€‚" }
        ];

        const depthProblems = [
            {
                title: "åŸºç¤ï¼šå»æ‹¬è™Ÿèˆ‡è®Šè™ŸæŒ‘æˆ°",
                expression: "-(8 - 3)",
                steps: [
                    { text: "1. è§€å¯Ÿæ‹¬è™Ÿå¤–çš„ã€Œ-ã€è™Ÿ", detail: "è² è™Ÿæº–å‚™é€²å…¥æ‹¬è™Ÿå…§éƒ¨ã€‚é€™æœƒè®“å…§éƒ¨çš„æ¯ä¸€é …éƒ½ã€Œåéä¾†ã€ã€‚", type: "info" },
                    { text: "2. ç¬¬ä¸€é …ã€Œ8ã€çš„ç¬¦è™Ÿ", detail: "8 åŸæœ¬æ˜¯æ­£çš„ã€‚åˆ†é…åˆ°è² è™Ÿå¾Œï¼Œå®ƒæœƒè®Šè™Ÿæˆï¼š", type: "sign", answer: "-", prefix: "", suffix: "8", hint: "æ‹¬è™Ÿå¤–æ˜¯è² è™Ÿï¼Œè£¡é¢çš„æ­£æ•¸ 8 å¿…é ˆè®Šè™Ÿã€‚" },
                    { text: "3. ç¬¬äºŒé …ã€Œ3ã€çš„ç¬¦è™Ÿ", detail: "åŸæœ¬æ˜¯ã€Œ-3ã€ã€‚é‡åˆ°è² è™Ÿã€Œè² è² å¾—æ­£ã€å¾Œæœƒè®Šæˆï¼š", type: "sign", answer: "+", prefix: "-8 ", suffix: "3", hint: "é—œéµé»ï¼è² è™Ÿåˆ†é…çµ¦è²  3ï¼Œæœƒè®Šæˆæ­£çš„ã€‚" },
                    { text: "4. æœ€å¾Œè¨ˆç®—çµæœ", detail: "ç¾åœ¨è«‹è¨ˆç®— -8 + 3ï¼š", type: "input", answer: "-5", hint: "æ¬  8 å…ƒé‚„äº† 3 å…ƒï¼Œé‚„æ¬  5 å…ƒã€‚" }
                ]
            },
            {
                title: "é€²éšï¼šå¤šé …å¼è®Šè™ŸæŒ‘æˆ°",
                expression: "-(12 - 5 + 7)",
                steps: [
                    { text: "1. è§€å¯Ÿä¸‰é …çš„è®Šè™Ÿ", detail: "è² è™Ÿè¦å° 12, -5, +7 åˆ†åˆ¥é€²è¡Œåˆ†é…ã€‚", type: "info" },
                    { text: "2. ç¬¬ä¸€é … 12 èˆ‡ç¬¬äºŒé … 5", detail: "å»æ‹¬è™Ÿå¾Œï¼Œ12 è®Š -12ï¼Œé‚£éº¼ -5 æœƒè®Šæˆä»€éº¼ç¬¦è™Ÿï¼Ÿ", type: "sign", answer: "+", prefix: "-12 ", suffix: "5", hint: "è² è™Ÿå°ä¸ŠåŸæœ¬çš„ -5ï¼Œè² è² å¾—æ­£ã€‚" },
                    { text: "3. æœ€å¾Œä¸€é … 7", detail: "åŸæœ¬çš„ +7 é‡åˆ°è² è™Ÿæœƒè®Šä»€éº¼ç¬¦è™Ÿï¼Ÿ", type: "sign", answer: "-", prefix: "-12 + 5 ", suffix: "7", hint: "æ¯ä¸€é …éƒ½è¦è®Šè™Ÿï¼ŒåŒ…å«æœ€å¾Œçš„æ­£ 7ã€‚" },
                    { text: "4. è¨ˆç®—çµæœ", detail: "è¨ˆç®— -12 + 5 - 7ï¼š", type: "input", answer: "-14", hint: "å¯ä»¥å…ˆç®— -12+5=-7ï¼Œå†ç®— -7-7ã€‚" }
                ]
            }
        ];

        // --- State ---
        let labProblemIdx = 0;
        let labStep = 0;
        let speedStep = 0;
        let checkedQuestions = {};
        let userAnswers = {};

        // --- Initialization ---
        window.onload = () => {
            lucide.createIcons();
            initLawQuiz();
            renderLab();
            renderSpeedChallenge();
            renderTest();
        };

        // --- Law Quiz ---
        function initLawQuiz() {
            const container = document.getElementById('law-quiz-container');
            container.innerHTML = lawQuizData.map((item, idx) => `
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <p class="text-lg font-mono font-bold text-slate-700 mb-3">${item.q}</p>
                    <div class="flex flex-wrap gap-2">
                        ${["äº¤æ›å¾‹", "çµåˆå¾‹", "åˆ†é…å¾‹"].map(btn => `
                            <button onclick="checkLaw(${idx}, '${btn}')" class="px-4 py-1.5 bg-white border border-slate-300 hover:border-indigo-500 rounded-lg text-sm font-bold transition-all">${btn}</button>
                        `).join('')}
                    </div>
                    <p id="law-feedback-${idx}" class="mt-2 text-sm font-bold hidden"></p>
                </div>
            `).join('');
        }

        function checkLaw(idx, choice) {
            const feedback = document.getElementById(`law-feedback-${idx}`);
            const item = lawQuizData[idx];
            feedback.classList.remove('hidden');
            if (choice === item.a) {
                feedback.className = "mt-2 text-sm font-bold text-green-600";
                feedback.innerHTML = `âœ… æ­£ç¢ºï¼${item.detail}`;
            } else {
                feedback.className = "mt-2 text-sm font-bold text-red-600";
                feedback.innerHTML = `âŒ å†æƒ³æƒ³çœ‹å–”ï¼${item.detail}`;
            }
        }

        // --- Lab ---
        function renderLab() {
            const problem = depthProblems[labProblemIdx];
            const header = document.getElementById('lab-header');
            const stepsContainer = document.getElementById('lab-steps');
            const successDiv = document.getElementById('lab-success');

            header.innerHTML = `
                <span class="text-xs font-bold text-slate-400 uppercase tracking-widest bg-slate-100 px-3 py-1 rounded-full">${problem.title}</span>
                <div class="text-5xl font-mono font-black text-slate-800 mt-4">${problem.expression}</div>
            `;

            successDiv.classList.add('hidden');
            stepsContainer.innerHTML = problem.steps.map((s, i) => {
                const isActive = labStep === i;
                const isPast = labStep > i;
                const stateClass = isActive ? 'step-active' : (isPast ? 'bg-slate-50 border-slate-100 opacity-60' : 'step-inactive');
                
                let actionHtml = '';
                if (isActive) {
                    if (s.type === 'info') {
                        actionHtml = `<button onclick="nextLabStep()" class="px-4 py-2 bg-amber-500 text-white rounded-lg font-bold hover:bg-amber-600 transition-colors shadow-sm">äº†è§£ï¼</button>`;
                    } else if (s.type === 'sign') {
                        actionHtml = `
                            <div class="flex items-center gap-2 bg-white p-2 rounded-xl border border-slate-200">
                                <span class="font-mono font-bold text-slate-400">${s.prefix}</span>
                                <button onclick="checkLabInput('+')" class="p-2 border rounded-lg hover:bg-blue-50 text-blue-600"><i data-lucide="plus"></i></button>
                                <button onclick="checkLabInput('-')" class="p-2 border rounded-lg hover:bg-red-50 text-red-600"><i data-lucide="minus"></i></button>
                                <span class="font-mono font-bold text-slate-800">${s.suffix}</span>
                            </div>
                        `;
                    } else if (s.type === 'input') {
                        actionHtml = `
                            <div class="flex items-center gap-2">
                                <input id="lab-input-field" type="text" class="w-24 p-2 border-2 rounded-lg text-center font-bold" placeholder="ç­”æ¡ˆ">
                                <button onclick="checkLabInput()" class="p-2 bg-amber-500 text-white rounded-lg"><i data-lucide="send" class="w-4 h-4"></i></button>
                            </div>
                        `;
                    }
                } else if (isPast) {
                    const resultText = s.final ? `= ${s.final}` : (s.result || '');
                    actionHtml = `<div class="px-3 py-1 bg-amber-50 text-amber-700 font-mono font-bold rounded">${resultText}</div>`;
                }

                return `
                    <div class="p-5 rounded-xl border-2 transition-all duration-300 flex flex-col md:flex-row md:items-center justify-between gap-4 ${stateClass}">
                        <div class="flex-1">
                            <h4 class="font-bold text-slate-800 flex items-center gap-2">
                                ${isPast ? '<i data-lucide="check-circle-2" class="text-green-500 w-4 h-4"></i>' : '<span class="w-4 h-4 rounded-full border border-slate-300"></span>'}
                                ${s.text}
                            </h4>
                            ${isActive ? `<p class="text-sm text-slate-600 mt-1 pl-6">${s.detail}</p>` : ''}
                        </div>
                        <div class="flex flex-col items-end gap-1">
                            ${actionHtml}
                            <div id="lab-hint-${i}" class="text-red-500 text-xs font-bold hidden">æç¤ºï¼š${s.hint}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (labStep === problem.steps.length) {
                successDiv.classList.remove('hidden');
                successDiv.innerHTML = `
                    <div class="bg-green-50 p-6 rounded-2xl border border-green-200">
                        <i data-lucide="trophy" class="w-12 h-12 text-yellow-500 mx-auto mb-2"></i>
                        <p class="text-green-800 font-bold text-xl">å…¨å°ï¼æ•¸æ„Ÿå¤§å‡ç´šã€‚</p>
                        <button onclick="nextLabProblem()" class="mt-4 bg-green-600 text-white px-6 py-2 rounded-xl font-bold">ä¸‹ä¸€é—œ</button>
                    </div>
                `;
            }
            lucide.createIcons();
        }

        function checkLabInput(value) {
            const problem = depthProblems[labProblemIdx];
            const step = problem.steps[labStep];
            const val = value || document.getElementById('lab-input-field').value.trim();
            
            if (val === step.answer) {
                labStep++;
                renderLab();
            } else {
                const container = document.querySelector('.step-active');
                container.classList.add('animate-shake');
                document.getElementById(`lab-hint-${labStep}`).classList.remove('hidden');
                setTimeout(() => container.classList.remove('animate-shake'), 400);
            }
        }

        function nextLabStep() { labStep++; renderLab(); }
        function nextLabProblem() { labProblemIdx = (labProblemIdx + 1) % depthProblems.length; labStep = 0; renderLab(); }

        // --- Speed Challenge ---
        function renderSpeedChallenge() {
            const container = document.getElementById('speed-challenge-container');
            let content = '';

            if (speedStep === 0) {
                content = `
                    <div class="text-center">
                        <p class="mb-4 text-indigo-100">1. å“ªå€‹æ•¸å­—æ˜¯<b>ã€Œå…±åŒå› æ•¸ã€</b>ï¼Ÿ</p>
                        <div class="flex gap-4 justify-center">
                            <button onclick="checkSpeed('99')" class="px-8 py-2 bg-white text-indigo-900 rounded-xl font-bold">99</button>
                            <button onclick="checkSpeed('6')" class="px-8 py-2 bg-white text-indigo-900 rounded-xl font-bold">6</button>
                        </div>
                    </div>
                `;
            } else if (speedStep === 1) {
                content = `
                    <div class="text-center">
                        <p class="mb-4 text-indigo-100">2. æå–å…¬å› æ•¸ 6 å¾Œï¼Œæ‹¬è™Ÿå…§å¡«å…¥ä»€éº¼ï¼Ÿ</p>
                        <div class="flex items-center gap-3 justify-center">
                            <span class="text-2xl">(</span>
                            <input id="speed-in-1" type="text" placeholder="? + ?" class="w-32 bg-transparent border-b-2 text-center text-white outline-none font-mono">
                            <span class="text-2xl">) Ã— 6</span>
                            <button onclick="checkSpeed()" class="p-2 bg-yellow-400 text-indigo-900 rounded-lg"><i data-lucide="send" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                `;
            } else if (speedStep === 2) {
                content = `
                    <div class="text-center">
                        <p class="mb-4 text-indigo-100">3. æœ€çµ‚ç­”æ¡ˆæ˜¯å¤šå°‘ï¼Ÿ</p>
                        <div class="flex items-center gap-3 justify-center">
                            <input id="speed-in-2" type="text" placeholder="ç­”æ¡ˆ" class="w-32 bg-transparent border-b-2 text-center text-white outline-none font-mono">
                            <button onclick="checkSpeed()" class="p-2 bg-yellow-400 text-indigo-900 rounded-lg"><i data-lucide="check" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                `;
            } else {
                content = `
                    <div class="text-center">
                        <div class="bg-green-500/40 p-4 rounded-xl border border-green-500/50 inline-block mb-2">
                            <i data-lucide="trophy" class="w-8 h-8 text-yellow-300 mx-auto mb-1"></i>
                            <p class="text-xl font-bold">600</p>
                        </div>
                        <p class="text-xs opacity-70">å¤ªæ£’äº†ï¼</p>
                        <button onclick="speedStep=0;renderSpeedChallenge()" class="text-white underline text-xs mt-2 block mx-auto">å†ç·´ä¸€æ¬¡</button>
                    </div>
                `;
            }
            container.innerHTML = content;
            lucide.createIcons();
        }

        function checkSpeed(val) {
            if (speedStep === 0) {
                if (val === '6') speedStep++;
                else document.getElementById('speed-challenge-container').classList.add('animate-shake');
            } else if (speedStep === 1) {
                const input = document.getElementById('speed-in-1').value.replace(/\s/g, '');
                if (input === '99+1' || input === '1+99') speedStep++;
                else document.getElementById('speed-challenge-container').classList.add('animate-shake');
            } else if (speedStep === 2) {
                const input = document.getElementById('speed-in-2').value.trim();
                if (input === '600') speedStep++;
                else document.getElementById('speed-challenge-container').classList.add('animate-shake');
            }
            renderSpeedChallenge();
            setTimeout(() => document.getElementById('speed-challenge-container').classList.remove('animate-shake'), 400);
        }

        // --- Test ---
        function renderTest() {
            const container = document.getElementById('test-container');
            container.innerHTML = testQuestions.map((q, idx) => {
                const isChecked = checkedQuestions[q.id];
                const isCorrect = userAnswers[q.id] === q.answer;
                const statusClass = isChecked ? (isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-slate-200 focus:border-indigo-500';

                return `
                    <div class="relative pl-8">
                        <span class="absolute left-0 top-0 text-3xl font-black text-indigo-100">${idx + 1}</span>
                        <div class="mb-4">
                            <h3 class="font-bold text-indigo-900 text-lg mb-1">${q.title}</h3>
                            <p class="text-slate-800 text-xl font-mono bg-slate-50 p-4 rounded-xl border border-slate-100 shadow-inner">${q.q}</p>
                        </div>
                        <div class="flex flex-wrap items-center gap-4">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-slate-500">ç­”ï¼š</span>
                                <input id="test-input-${q.id}" type="text" value="${userAnswers[q.id] || ''}" ${isChecked ? 'disabled' : ''} class="w-full md:w-48 px-4 py-2 border-2 rounded-lg font-mono ${statusClass}" placeholder="å¡«å…¥æ•¸å­—">
                            </div>
                            ${!isChecked ? `
                                <button onclick="checkTestAnswer(${q.id})" class="px-6 py-2 bg-indigo-500 text-white rounded-lg font-bold hover:bg-indigo-600 transition-all flex items-center gap-1">
                                    <i data-lucide="send" class="w-4 h-4"></i> å°ç­”æ¡ˆ
                                </button>
                            ` : `
                                <div class="flex items-center gap-3">
                                    <span class="font-bold px-3 py-1 rounded-full ${isCorrect ? 'text-green-600 bg-green-100' : 'text-red-600 bg-red-100'}">
                                        ${isCorrect ? 'âœ… æ­£ç¢º' : 'âŒ éŒ¯èª¤'}
                                    </span>
                                    <button onclick="resetQuestion(${q.id})" class="text-slate-400 hover:text-indigo-600 text-sm underline">é‡å¯«</button>
                                </div>
                            `}
                        </div>
                        ${isChecked ? `
                            <div class="mt-4 p-4 bg-indigo-50 rounded-xl border border-indigo-100 text-sm text-indigo-900">
                                ${!isCorrect ? `<p class="mb-2 font-black text-red-600 italic">æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${q.answer}</p>` : ''}
                                <span class="font-bold flex items-center gap-1 mb-1"><i data-lucide="lightbulb" class="w-4 h-4"></i> è§£é¡Œå»ºè­°ï¼š</span>
                                ${q.hint}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            updateSummary();
            lucide.createIcons();
        }

        function checkTestAnswer(id) {
            const val = document.getElementById(`test-input-${id}`).value.trim();
            userAnswers[id] = val;
            checkedQuestions[id] = true;
            renderTest();
        }

        function resetQuestion(id) {
            delete userAnswers[id];
            delete checkedQuestions[id];
            renderTest();
        }

        function updateSummary() {
            const summary = document.getElementById('test-summary');
            const done = Object.keys(checkedQuestions).length;
            const correctCount = testQuestions.filter(q => checkedQuestions[q.id] && userAnswers[q.id] === q.answer).length;

            summary.innerHTML = `
                <div class="flex gap-2 mb-4">
                    ${testQuestions.map(q => `
                        <div class="w-4 h-4 rounded-full ${checkedQuestions[q.id] ? (userAnswers[q.id] === q.answer ? 'bg-green-500' : 'bg-red-500') : 'bg-slate-200'}"></div>
                    `).join('')}
                </div>
                <p class="text-slate-500 font-bold italic text-sm">ç›®å‰é€²åº¦ï¼šå·²å®Œæˆ ${done} / ${testQuestions.length} é¡Œ (ç­”å° ${correctCount} é¡Œ)</p>
                ${done === testQuestions.length ? `
                    <div class="mt-6 animate-in zoom-in">
                        <i data-lucide="trophy" class="w-12 h-12 text-yellow-400 mx-auto mb-2"></i>
                        <p class="text-3xl font-black text-indigo-900">${correctCount * 20} åˆ†ï¼</p>
                        <button onclick="resetAllTest()" class="mt-4 px-6 py-2 bg-slate-200 text-slate-700 rounded-full font-bold">å…¨éƒ¨é‡è€ƒ</button>
                    </div>
                ` : ''}
            `;
            lucide.createIcons();
        }

        function resetAllTest() {
            userAnswers = {};
            checkedQuestions = {};
            renderTest();
        }
    </script>
</body>
</html>
